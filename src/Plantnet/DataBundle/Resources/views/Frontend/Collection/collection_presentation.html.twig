{% set imgs = [] %}
{% set nb_img = 3 %}
{% for module in collection.modules if module.deleting != true %}
	{% for child in module.children if (child.deleting != true and child.type == 'image') %}
		{% if child.nbrows > 0 and imgs|length < nb_img %}
			{% for image in child.images if imgs|length < nb_img %}
				{% set imgs = imgs|merge([image]) %}
			{% endfor %}
		{% endif %}
	{% endfor %}
{% endfor %}
<div class="collection_presentation">
	<div class="row">
		<div class="span9">
			<h4>
				<a href="{{ path('front_collection', { 'project': project, 'collection': collection.url }) }}">
					{{ collection.name }}
				</a>
			</h4>
			{% if imgs|length > 0 %}
				<div class="row">
					<div class="span4">
						<div class="images">
							<div id="carousel_{{ collection.id }}" class="carousel slide img-polaroid">
								<ol class="carousel-indicators">
									{% for image in imgs %}
										<li data-target="#carousel_{{ collection.id }}" data-slide-to="{{ loop.index0 }}"{% if loop.index0 == 0 %} class="active"{% endif %}></li>
									{% endfor %}
								</ol>
								<div class="carousel-inner">
									{% for image in imgs %}
										{% set imgspe = image.path|basename %}
										{% set img = ['uploads/'~image.module.uploaddir~'/', imgspe]|join('') %}
										<div class="{% if loop.index0 == 0 %}active {% endif %}item">
											<img src="{{ asset(img) | imagine_filter('thumb_370_210') }}" alt="{{ image.copyright }}" />
											{% if image.copyright is not empty %}
												<div class="carousel-caption">
													<p>{{ image.copyright }}</p>
												</div>
											{% endif %}
										</div>
									{% endfor %}
								</div>
							</div>
						</div>
					</div>
					<div class="span5">
						{% autoescape false %}
							{{ collection.description }}
						{% endautoescape %}
					</div>
				</div>
			{% else %}
				{% autoescape false %}
					{{ collection.description }}
				{% endautoescape %}
			{% endif %}
		</div>
		<div class="span3">
			<div class="details">
				{% for module in collection.modules if module.deleting != true %}
					{% set nbimg = 0 %}
					{% set nbloc = 0 %}
					{% for child in module.children if child.deleting != true %}
						{% if child.type == 'image' %}
							{% set nbimg = nbimg+child.nbrows %}
						{% elseif child.type == 'locality' %}
							{% set nbloc = nbloc+child.nbrows %}
						{% endif %}
					{% endfor %}
					<h5>
						<a href="{{ path('front_module', { 'project': project, 'collection': collection.url, 'module': module.url }) }}">
							{{ module.name }}
						</a>
					</h5>
					{% if module.nbrows > 0 %}
						<span class="badge pop-tooltip" data-toggle="tooltip" title="{{ module.nbrows }} {{ "line-entities"|trans }}">
							<i class="icon-list"></i>
							{{ module.nbrows }}
						</span>
					{% endif %}
					{% if nbimg > 0 %}
						<span class="badge pop-tooltip" data-toggle="tooltip" title="{{ nbimg }} {{ "line-images"|trans }}">
							<i class="icon-camera"></i>
							{{ nbimg }}
						</span>
					{% endif %}
					{% if nbloc > 0 %}
						<span class="badge pop-tooltip" data-toggle="tooltip" title="{{ nbloc }} {{ "line-locations"|trans }}">
							<i class="icon-map-marker"></i>
							{{ nbloc }}
						</span>
					{% endif %}
				{% endfor %}
			</div>
		</div>
	</div>
</div>