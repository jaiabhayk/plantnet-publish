{% extends app.request.isXmlHttpRequest ? "PlantnetDataBundle:Frontend:ajax_datatypes.html.twig" : "PlantnetDataBundle:Frontend:datatypes.html.twig" %}
{% block title collection.name ~ ' - ' ~ module.name ~ ' - ' ~ "line-taxonomy"|trans|capitalize %}
{% block stylesheets %}
    {{ parent() }}
{% endblock %}
{% block header %}<h1>{{ module.name }} - {{ "line-taxonomy"|trans|capitalize }}</h1>{% endblock %}
{% block breadcrumb %}
    <ul class="breadcrumb">
        <li>
            <a href="{{ url('_project', {'project': project}) }}">{{ project|capitalize }}</a>
            <span class="divider">/</span>
        </li>
        <li>
            <a href="{{ path('_collection', { 'project': project, 'collection': collection.name }) }}">{{ collection.name }}</a>
            <span class="divider">/</span>
        </li>
        <li>
            <a href="{{ path('_module', { 'project': project, 'collection': collection.name, 'module': module.name }) }}">{{ module.name }}</a>
            <span class="divider">/</span>
        </li>
        <li>
            <a href="{{ path('_module_taxo', { 'project': project, 'collection': collection.name, 'module': module.name }) }}">{{ "line-taxonomy"|trans|capitalize }}</a>
            <span class="divider">/</span>
        </li>
        {% macro bc_taxon(taxon,project,collection,module) %}
            {% if taxon.parent %}
                {{ _self.bc_taxon(taxon.parent,project,collection,module) }}
                <li>
                    <a href="{{ path('_module_taxo_details', { 'project': project, 'collection': collection.name, 'module': module.name, 'level': taxon.parent.level, 'taxon': taxon.parent.name }) }}">{{ taxon.parent.name }}</a>
                    <span class="divider">/</span>
                </li>
            {% endif %}
        {% endmacro %}
        {% import _self as macros %}
        {{ macros.bc_taxon(taxon,project,collection,module) }}
        <li>
            <a href="{{ path('_module_taxo_details', { 'project': project, 'collection': collection.name, 'module': module.name, 'level': taxon.level, 'taxon': taxon.name }) }}">{{ taxon.name }}</a>
            <span class="divider">/</span>
        </li>
        <li class="active">
            <span class="badge">{{ nbResults }}</span> bla bla bla
        </li>
    </ul>
{% endblock %}
{% block side %}
    {% include "PlantnetDataBundle:Frontend:side.html.twig" with { module: module } %}
{% endblock %}
{% block main %}
    <div>
        {% if paginator|length > 0 %}
            <div class="pagerfanta">
                {% if paginator.haveToPaginate() %}
                    {% if sortby != 'null' and sortorder != 'null' %}
                        <form method="get" action="{{ path('_module_taxo_view_paginated_sorted', { 'project': project, 'collection': collection.name, 'module': module.name, 'level': taxon.level, 'taxon': taxon.name, 'page': page, 'sortby': sortby, 'sortorder': sortorder }) }}">
                            <input type="number" name="form_page" placeholder="{{ paginator.currentPage }}" class="span1" min="1" max="{{ paginator.nbPages }}" />
                        </form>
                    {% else %}
                        <form method="get" action="{{ path('_module_taxo_view', { 'project': project, 'collection': collection.name, 'module': module.name, 'level': taxon.level, 'taxon': taxon.name }) }}">
                            <input type="number" name="form_page" placeholder="{{ paginator.currentPage }}" class="span1" min="1" max="{{ paginator.nbPages }}" />
                        </form>
                    {% endif %}
                {% endif %}
                {% if sortby != 'null' and sortorder != 'null' %}
                    {{ pagerfanta(
                        paginator,
                        'twitter_bootstrap_translated',
                        {
                            'proximity': 2,
                            'routeName': '_module_taxo_view_paginated_sorted',
                            'routeParams': {
                                'project': project,
                                'collection': collection.name,
                                'module': module.name,
                                'level': taxon.level,
                                'taxon': taxon.name,
                                'sortby': sortby,
                                'sortorder': sortorder,
                            }
                        }
                    ) }}
                {% else %}
                    {{ pagerfanta(
                        paginator,
                        'twitter_bootstrap_translated',
                        {
                            'proximity': 2,
                            'routeName': '_module_taxo_view_paginated',
                            'routeParams': {
                                'project': project,
                                'collection': collection.name,
                                'module': module.name,
                                'level': taxon.level,
                                'taxon': taxon.name
                            }
                        }
                    ) }}
                {% endif %}
            </div>
             <table class="table table-striped table-hover tr-link">
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        {% for property in module.properties if property.id in display %}
                            <th>
                                {{ property.name }}
                                <span class="nowrap">
                                    <a href="{{ path('_module_taxo_view', { 'project': project, 'collection': collection.name, 'module': module.name, 'level': taxon.level, 'taxon': taxon.name }) }}/page1/sort-{{ property.id }}/order-asc">
                                        <i class="icon-circle-arrow-up"></i></a>
                                    <a href="{{ path('_module_taxo_view', { 'project': project, 'collection': collection.name, 'module': module.name, 'level': taxon.level, 'taxon': taxon.name }) }}/page1/sort-{{ property.id }}/order-desc">
                                        <i class="icon-circle-arrow-down"></i></a>
                                </span>
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for plantunit in paginator %}
                        <tr>
                            <td>
                                <a href="{{ path('_details', { 'project': project, 'collection': collection.name, 'module': module.name, 'id': plantunit.id }) }}">
                                    {% if plantunit.hasimages > 0 %}
                                        <i class="icon-camera"></i>
                                    {% endif %}
                                </a>
                            </td>
                            <td>
                                <a href="{{ path('_details', { 'project': project, 'collection': collection.name, 'module': module.name, 'id': plantunit.id }) }}">
                                    {% if plantunit.haslocations > 0 %}
                                        <i class="icon-map-marker"></i>
                                    {% endif %}
                                </a>
                            </td>
                            {% for field in display %}
                                <td>
                                    <a href="{{ path('_details', { 'project': project, 'collection': collection.name, 'module': module.name, 'id': plantunit.id }) }}">
                                        {{ plantunit.attributes[field] }}
                                    </a>
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="pagerfanta">
                {% if sortby != 'null' and sortorder != 'null' %}
                    {{ pagerfanta(
                        paginator,
                        'twitter_bootstrap_translated',
                        {
                            'proximity': 2,
                            'routeName': '_module_taxo_view_paginated_sorted',
                            'routeParams': {
                                'project': project,
                                'collection': collection.name,
                                'module': module.name,
                                'level': taxon.level,
                                'taxon': taxon.name,
                                'sortby': sortby,
                                'sortorder': sortorder,
                            }
                        }
                    ) }}
                {% else %}
                    {{ pagerfanta(
                        paginator,
                        'twitter_bootstrap_translated',
                        {
                            'proximity': 2,
                            'routeName': '_module_taxo_view_paginated',
                            'routeParams': {
                                'project': project,
                                'collection': collection.name,
                                'module': module.name,
                                'level': taxon.level,
                                'taxon': taxon.name
                            }
                        }
                    ) }}
                {% endif %}
            </div>
        {% endif %}
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
{% endblock %}