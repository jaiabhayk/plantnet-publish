{% extends app.request.isXmlHttpRequest ? "PlantnetDataBundle:Backend:ajax_form_layout.html.twig" : "PlantnetDataBundle:Backend:form_layout.html.twig" %}
{% block stylesheets %}
    {{ parent() }}
{% endblock %}
{% block form %}
    <div id="title-form">
        <h4 class="text-info">
            <em>Module: {{ module.name }}</em> > Update data
        </h4>
    </div>
    {% for flashmessage in app.session.flashbag.get('error') %}
        <div class="flash-error">
            <p class="text-error">
                {{ flashmessage }}
            </p>
        </div>
    {% endfor %}
    {% set updating = false %}
    {% if module.updating == true %}
        {% set updating = true %}
    {% endif %}
    {% if module.parent is defined and module.parent is not null and module.parent.updating == true %}
        {% set updating = true %}
    {% endif %}
    {% for child in module.children %}
        {% if child.updating == true %}
            {% set updating = true %}
        {% endif %}
    {% endfor %}
    {% if updating == false %}
        <p>
            <strong>Module description:</strong>
        </p>
        <table class="table table-bordered table-hover table-condensed">
            <tr>
                <td>Module name</td>
                <td>{{ module.name }}</td>
            </tr>
            <tr>
                <td>Number of data</td>
                <td>{{ module.nbrows }}</td>
            </tr>
            {% if module.type == 'text' %}
                <tr>
                    <td>Taxonomy</td>
                    <td>{% if module.taxonomy == true %}Enabled{% else %}Disabled{% endif %}</td>
                </tr>
                <tr>
                    <td>{% if module.children|length >= 2 %}Children{% else %}Child{% endif %}</td>
                    <td>
                        {% for child in module.children if child.deleting != true %}
                            {{ child.name }}<br />
                        {% endfor %}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td>Parent</td>
                    <td>{{ module.parent.name }}</td>
                </tr>
            {% endif %}
        </table>
        <p>
            <strong>Current module configuration:</strong>
        </p>
        <table class="table table-bordered table-hover table-condensed">
            <thead>
                <tr>
                    <th>NÂ°</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Main</th>
                    <th>Details</th>
                    <th>Search</th>
                </tr>
            </thead>
            <tbody>
                {% for prop in module.properties %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ prop.name }}</td>
                        <td>{{ prop.type }}</td>
                        <td>{% if prop.main == true %}<i class="icon-ok"></i>{% endif %}</td>
                        <td>{% if prop.details == true %}<i class="icon-ok"></i>{% endif %}</td>
                        <td>{% if prop.search == true %}<i class="icon-ok"></i>{% endif %}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <form action="{{ path('module_update_data', { 'id': module.id }) }}" method="post" {{ form_enctype(form) }}>
            {{ form_errors(form) }}
            <div class="field-form">
                {{ form_label(form.file, 'CSV data') }}
                {{ form_errors(form.file) }}
                {{ form_widget(form.file) }}
            </div>
            {{ form_rest(form) }}
            <br />
            <button type="submit" class="btn">Import data</button>
        </form>
    {% else %}
        <p class="text-warning">
            There is a work in progress, update action is disabled few minutes.
        </p>
    {% endif %}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $(document).ready(function(){
            ;
        });
    </script>
{% endblock %}